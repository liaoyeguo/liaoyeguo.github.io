<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.edb6b97ebd5b111de814.css">.nav-module--nav--2UHDn{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;background:#fff;padding:0 20%}.nav-module--nav--2UHDn .nav-module--logo--UI6mG{margin-right:1rem;padding:1.5rem 1.8rem}.nav-module--nav--2UHDn ul{display:-webkit-flex;display:flex;-webkit-flex-direction:row;flex-direction:row}.nav-module--navItem--1QZTn{padding:1.5rem 1.8rem;color:rgba(0,0,0,.9);font-size:1.25rem;cursor:pointer;font-weight:400;list-style:none}body,html{margin:0;padding:0;background:#f1f3f4;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica Neue,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;min-height:100vh}a{color:inherit;text-decoration:none;-webkit-text-decoration-skip:ink;text-decoration-skip:ink;text-decoration-skip-ink:auto}ul{padding:0;margin:0}.container{padding-top:2rem}.container,.footer-module--footer--1Uwu1{display:-webkit-flex;display:flex;-webkit-justify-content:center;justify-content:center}.footer-module--footer--1Uwu1{position:absolute;bottom:0;width:100%;background:#fff}.markdownContent{color:#212529}.markdownContent h1,h2,h3,h4,h5,h6{margin-top:3rem;line-height:1.25}.markdownContent h1{font-size:2.5rem}.markdownContent h2{font-size:2rem}.markdownContent h3{font-size:1.75rem}.markdownContent h4{font-size:1.5rem}.markdownContent h5{font-size:1.25rem}.markdownContent h6{font-size:1rem}.markdownContent h1 code,h2 code,h3 code,h4 code,h5 code,h6 code{background-color:transparent;color:inherit}.markdownContent p{font-size:1rem;line-height:1.75;margin:1rem 0}.markdownContent p code{padding:.3em .5em;font-size:.9rem;background:#f2f4f5;border-radius:3px;margin:0 1px;border:1px solid #eee}.markdownContent pre{background:#f2f4f5;margin:16px 0;padding:12px 20px;border-radius:3px}.markdownContent pre code{font-family:Lucida Console,Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;line-height:1.5;color:#314659}.markdownContent pre.language-css .token.selector{color:#6f42c1}.markdownContent pre.language-css .token.punctuation{color:#999}.markdownContent pre.language-css .token.comment{color:#708090}.markdownContent pre.language-css .token.hexcode{color:#314659}.markdownContent pre.language-css .token.function,.markdownContent pre.language-css .token.property{color:#005cc5}.markdownContent pre.language-js,.token.keyword{color:#008dff}.markdownContent pre.language-js,.token.punctuation{color:#999}.markdownContent pre.language-js .token.function{color:#f81d22}.markdownContent pre.language-js .token.comment{color:#708090}.markdownContent pre.language-js .token.interpolation-punctuation,.markdownContent pre.language-js .token.operator,.markdownContent pre.language-js .token.string,.template-string{color:#0b8235}.markdownContent pre.language-js .token.tag{color:#f81d22}.markdownContent pre.language-js .token.attr-name{color:#0b8235}.markdownContent pre.language-js .token.attr-value{color:#008dff}.markdownContent pre.language-js .token.number{color:#f81d22}.markdownContent pre.language-jsx .token.keyword{color:#008dff}.markdownContent pre.language-jsx .token.punctuation{color:#999}.markdownContent pre.language-jsx .token.function{color:#f81d22}.markdownContent pre.language-jsx .token.comment{color:#708090}.markdownContent pre.language-jsx .token.interpolation-punctuation,.markdownContent pre.language-jsx .token.operator,.markdownContent pre.language-jsx .token.string,.template-string{color:#0b8235}.markdownContent pre.language-jsx .token.tag{color:#f81d22}.markdownContent pre.language-jsx .token.attr-name{color:#0b8235}.markdownContent pre.language-jsx .token.attr-value{color:#008dff}.markdownContent pre.language-html .token.tag,.markdownContent pre.language-jsx .token.number{color:#f81d22}.markdownContent pre.language-html .token.attr-name{color:#0b8235}.markdownContent pre.language-html .token.attr-value{color:#008dff}.markdownContent pre.language-html .token.punctuation{color:#999}.markdownContent pre.language-html .token.function,.markdownContent pre.language-html .token.property{color:#005cc5}.markdownContent a{color:#6a65d8}.markdownContent blockquote{color:#697b8c;border-left:8px solid #ebedf0;padding-left:1rem;margin-top:2rem;margin-bottom:2rem}.blogpost-module--post--1LvNB{width:960px;background:#fff;padding:1rem 2rem;margin-bottom:2rem}.blogpost-module--post--1LvNB h1{font-size:2.5rem;margin-bottom:.5rem}.frontend-module--posts--2Lzpn{background:#fff;max-width:960px;padding:1rem 2rem;margin-bottom:2rem}.frontend-module--post--2YXgh{padding-top:1rem;border-bottom:1px solid #eee}.frontend-module--year--1WA5o{position:relative;padding-left:1.5rem}.frontend-module--year--1WA5o:before{box-sizing:border-box;content:"";width:1rem;height:1rem;display:inline-block;border:.2rem solid #7e50bb;border-radius:50%;position:absolute;top:50%;left:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.index-module--posts--1CKqU{background:#fff;width:960px;padding:1rem 2rem;margin-bottom:2rem}.index-module--post--3OQ6k{padding-top:1rem;border-bottom:1px solid #eee}.index-module--year--1MDRF{position:relative;padding-left:1.5rem}.index-module--year--1MDRF:before{box-sizing:border-box;content:"";width:1rem;height:1rem;display:inline-block;border:.2rem solid #7e50bb;border-radius:50%;position:absolute;top:50%;left:0;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.index-module--noPost--3tnQd{text-align:center;color:#333}</style><meta name="generator" content="Gatsby 2.10.0"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 16)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Gatsby RSS Feed" href="/rss.xml"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#f1f3f4"/><link rel="apple-touch-icon" sizes="192x192" href="/android-chrome-192x192.png"/><link rel="apple-touch-icon" sizes="512x512" href="/android-chrome-512x512.png"/><title data-react-helmet="true">ÂìàÂìàÂìà123123 ‚Ä¢ üéÇÂªñ‰∏öÂõΩÁöÑÂçöÂÆ¢</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"/><link data-react-helmet="true" rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"/><link data-react-helmet="true" rel="mask-icon" href="/safari-pinned-tab.svg"/><meta data-react-helmet="true" name="description" content="In its quest to glorify the scrobble, Last.fm has forgotten the humble album. We can almost fix that."/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" property="og:site_name" content="üéÇÂªñ‰∏öÂõΩÁöÑÂçöÂÆ¢"/><meta data-react-helmet="true" property="og:title" name="twitter:title" content="ÂìàÂìàÂìà123123"/><meta data-react-helmet="true" property="og:url" content="https://blog.liaoyeguo.com/frontend/4721c510-4a13-512a-a877-9e46c694d307"/><meta data-react-helmet="true" property="og:description" name="twitter:description" content="In its quest to glorify the scrobble, Last.fm has forgotten the humble album. We can almost fix that."/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link as="script" rel="preload" href="/app-b5d5a46c54ead1256f73.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-blog-post-js-a01d3f043eb43e1152c8.js"/><link as="script" rel="preload" href="/styles-82705b588e8329c6f98a.js"/><link as="script" rel="preload" href="/webpack-runtime-1120c1d0c68a506ac800.js"/><link as="fetch" rel="preload" href="/page-data\frontend\4721c510-4a13-512a-a877-9e46c694d307\page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><nav class="nav-module--nav--2UHDn"><span class="nav-module--logo--UI6mG"><a href="/">liaoyeguo</a></span><ul></ul></nav><div class="container"><div class="blogpost-module--post--1LvNB"><article><h1>ÂìàÂìàÂìà123123</h1><time dateTime="2018-03-12">March 12, 2018</time><div class="markdownContent"><p>Years ago, I deleted¬†my <a href="https://last.fm">Last.fm</a> account, because it felt like a dying social media network. Months ago, I¬†created <a href="https://www.last.fm/user/lowmess">a new one</a>, because Last.fm is a treasure trove of behaviorally generated personal data. It‚Äôs a lovely service for a developer to have around for side projects, as it provides instant and easy access to a large dataset with a particularly personal connection if you‚Äôre a music lover. In the process of using it¬†for <a href="/about/">one of those side¬†projects</a>, I found a dark &#x26; disturbing secret: Last.fm actually kind of sucks for tracking album¬†plays.132132132132132</p>
<p>Fair warning: things are about to take a turn for the opinionated, pedantic, and downright¬†trivial.</p>
<h2 id="the-scrobble-killed-the-record-star"><a href="#the-scrobble-killed-the-record-star" aria-label="the scrobble killed the record star permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Scrobble Killed the Record¬†Star</h2>
<p>Last.fm is built upon an atomic unit: the scrobble. From it, all other units are derived. A scrobble represents one play of one song, and Last.fm sets your top album by how many scrobbles it has. The problem with this is that it‚Äôs the complete wrong way to count album¬†plays.</p>
<p>Album play counts are slightly different than song play counts. They should start from basically the same place ‚Äî one playthrough is one playthrough ‚Äî but from there they branch in subtle but important ways. For example, it is much more common to only partially listen to an album than it is to partially listen to a song. Albums are also, generally, between 10 and 12 times longer than songs, and broken into as many¬†parts.</p>
<p>If the length of an album is what makes a complete playthrough of an album rarer than a playthrough of a song, a playthrough of a longer album should count for more than that of a shorter album. (There‚Äôs an argument to be made that the same is true of songs, but we‚Äôll leave that for another day.) Thus, the ideal album ranking algorithm would account for total playthroughs, with a weight given to longer albums. Maybe even something as simple as¬†this:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js">albumPlaythroughs <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> albumDuration <span class="token operator">/</span> <span class="token number">2700</span><span class="token punctuation">)</span></code></pre></div>
<p>Here, we weight the duration in 45 minute increments, the length of a single LP¬†(<code class="language-text">albumDuration</code> being in seconds). Adding 1 to the duration calculation helps to ensure we‚Äôre not simply normalizing for record length ‚Äî while that is also a valid way to rank album plays, it is not the one I¬†prefer.</p>
<h2 id="ok-you-got-me-something-exactly-as-simple-as-that"><a href="#ok-you-got-me-something-exactly-as-simple-as-that" aria-label="ok you got me something exactly as simple as that permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ok, You Got Me. Something Exactly As Simple As¬†That</h2>
<p>Let‚Äôs take three albums of varying lengths and see how they handle this algorithm. Our¬†albums:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Cardinal"</span><span class="token punctuation">,</span>
    <span class="token property">"artist"</span><span class="token operator">:</span> <span class="token string">"Pinegrove"</span><span class="token punctuation">,</span>
    <span class="token property">"duration"</span><span class="token operator">:</span> <span class="token number">1845</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Marquee Moon"</span><span class="token punctuation">,</span>
    <span class="token property">"artist"</span><span class="token operator">:</span> <span class="token string">"Television"</span><span class="token punctuation">,</span>
    <span class="token property">"duration"</span><span class="token operator">:</span> <span class="token number">2754</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Summertime '06"</span><span class="token punctuation">,</span>
    <span class="token property">"artist"</span><span class="token operator">:</span> <span class="token string">"Vince Staples"</span><span class="token punctuation">,</span>
    <span class="token property">"duration"</span><span class="token operator">:</span> <span class="token number">3545</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre></div>
<p>Given one playthrough each, the three records will be ranked in exactly the same order they are now. Let‚Äôs listen to a few more¬†tracks.</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> cardinalRank <span class="token operator">=</span> <span class="token number">3.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1845</span> <span class="token operator">/</span> <span class="token number">2700</span><span class="token punctuation">)</span> <span class="token comment">// 5.89</span>
<span class="token keyword">const</span> marqueeRank <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">2745</span> <span class="token operator">/</span> <span class="token number">2700</span><span class="token punctuation">)</span> <span class="token comment">// 6.05</span>
<span class="token keyword">const</span> summertimeRank <span class="token operator">=</span> <span class="token number">2.5</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">3545</span> <span class="token operator">/</span> <span class="token number">2700</span><span class="token punctuation">)</span> <span class="token comment">// 5.78</span></code></pre></div>
<p>Now we‚Äôre getting somewhere. Even¬†though <em>Cardinal</em> has the most¬†playthroughs, <em>Marquee Moon</em> has the highest rank thanks to its lengthier¬†runtime. <em>Summertime ‚Äò06</em> is just barely in third place despite having a full playthrough less¬†than <em>Cardinal</em>. The system works,¬†folks.</p>
<h2 id="this-is-the-part-with-the-but"><a href="#this-is-the-part-with-the-but" aria-label="this is the part with the but permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>This Is the Part With the¬†‚ÄúBut‚Äù</h2>
<p>Given all the information we need, the algorithm works. But we still have to get the information, and unfortunately, Last.fm doesn‚Äôt make it too easy on¬†us:</p>
<ul>
<li>We can easily get a user‚Äôs top albums, but the response doesn‚Äôt include information on the amount of tracks on, or duration of, each¬†album.</li>
<li>Last.fm doesn‚Äôt use unique IDs to track albums, so we have to use an endpoint that searches by album name and artist to get detailed album information. This often fails or retrieves the wrong album, even when the album name and artist are provided by Last.fm (like from the previously discussed¬†endpoint).</li>
<li>Once we find an album, track listings are missing or incomplete about 20% of the time. This happens more often with newer¬†albums.</li>
<li>Neither the top albums nor album info endpoints give us the album‚Äôs release year. This doesn‚Äôt impact the algorithm, I just thought it was¬†odd.</li>
</ul>
<p>All told, to implement this algorithm on our own means we would have to make an insane amount of requests just to get incomplete or missing data. If you think that doesn‚Äôt sound like it‚Äôs worth it, you‚Äôre right. And while I didn‚Äôt use¬†it, <a href="https://gist.github.com/lowmess/f3c03b1a6fe50ee04622706047f8a654">you can see an implementation¬†here</a>.</p>
<p>Last.fm still ranks albums wrong,¬†though.</p></div></article></div></div><footer class="footer-module--footer--1Uwu1"></footer></div></div><script type="text/javascript">console.log('Wondering how this site was made? Check out the colophon: https://lowmess.com/colophon/')</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/frontend/4721c510-4a13-512a-a877-9e46c694d307";window.webpackCompilationHash="354c65fdf1f8f42980f7";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b5d5a46c54ead1256f73.js"],"component---src-templates-blog-post-blog-post-js":["/component---src-templates-blog-post-blog-post-js-a01d3f043eb43e1152c8.js"],"component---src-pages-404-js":["/component---src-pages-404-js-dae355a46335a98d4aaa.js"],"component---src-pages-frontend-index-js":["/component---src-pages-frontend-index-js-fcf385203653d57c3dcb.js"],"component---src-pages-index-js":["/component---src-pages-index-js-a8149e3671862a0e6261.js"]};/*]]>*/</script><script src="/webpack-runtime-1120c1d0c68a506ac800.js" async=""></script><script src="/styles-82705b588e8329c6f98a.js" async=""></script><script src="/component---src-templates-blog-post-blog-post-js-a01d3f043eb43e1152c8.js" async=""></script><script src="/app-b5d5a46c54ead1256f73.js" async=""></script></body></html>