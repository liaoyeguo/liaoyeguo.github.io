{"componentChunkName":"component---src-templates-blog-post-blog-post-js","path":"/frontend/4721c510-4a13-512a-a877-9e46c694d307","webpackCompilationHash":"354c65fdf1f8f42980f7","result":{"data":{"markdownRemark":{"html":"<p>Years ago, I deleted my <a href=\"https://last.fm\">Last.fm</a> account, because it felt like a dying social media network. Months ago, I created <a href=\"https://www.last.fm/user/lowmess\">a new one</a>, because Last.fm is a treasure trove of behaviorally generated personal data. It’s a lovely service for a developer to have around for side projects, as it provides instant and easy access to a large dataset with a particularly personal connection if you’re a music lover. In the process of using it for <a href=\"/about/\">one of those side projects</a>, I found a dark &#x26; disturbing secret: Last.fm actually kind of sucks for tracking album plays.132132132132132</p>\n<p>Fair warning: things are about to take a turn for the opinionated, pedantic, and downright trivial.</p>\n<h2 id=\"the-scrobble-killed-the-record-star\"><a href=\"#the-scrobble-killed-the-record-star\" aria-label=\"the scrobble killed the record star permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Scrobble Killed the Record Star</h2>\n<p>Last.fm is built upon an atomic unit: the scrobble. From it, all other units are derived. A scrobble represents one play of one song, and Last.fm sets your top album by how many scrobbles it has. The problem with this is that it’s the complete wrong way to count album plays.</p>\n<p>Album play counts are slightly different than song play counts. They should start from basically the same place — one playthrough is one playthrough — but from there they branch in subtle but important ways. For example, it is much more common to only partially listen to an album than it is to partially listen to a song. Albums are also, generally, between 10 and 12 times longer than songs, and broken into as many parts.</p>\n<p>If the length of an album is what makes a complete playthrough of an album rarer than a playthrough of a song, a playthrough of a longer album should count for more than that of a shorter album. (There’s an argument to be made that the same is true of songs, but we’ll leave that for another day.) Thus, the ideal album ranking algorithm would account for total playthroughs, with a weight given to longer albums. Maybe even something as simple as this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">albumPlaythroughs <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> albumDuration <span class=\"token operator\">/</span> <span class=\"token number\">2700</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Here, we weight the duration in 45 minute increments, the length of a single LP (<code class=\"language-text\">albumDuration</code> being in seconds). Adding 1 to the duration calculation helps to ensure we’re not simply normalizing for record length — while that is also a valid way to rank album plays, it is not the one I prefer.</p>\n<h2 id=\"ok-you-got-me-something-exactly-as-simple-as-that\"><a href=\"#ok-you-got-me-something-exactly-as-simple-as-that\" aria-label=\"ok you got me something exactly as simple as that permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ok, You Got Me. Something Exactly As Simple As That</h2>\n<p>Let’s take three albums of varying lengths and see how they handle this algorithm. Our albums:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Cardinal\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"artist\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Pinegrove\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"duration\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1845</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Marquee Moon\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"artist\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Television\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"duration\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2754</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Summertime '06\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"artist\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Vince Staples\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"duration\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3545</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Given one playthrough each, the three records will be ranked in exactly the same order they are now. Let’s listen to a few more tracks.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> cardinalRank <span class=\"token operator\">=</span> <span class=\"token number\">3.5</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1845</span> <span class=\"token operator\">/</span> <span class=\"token number\">2700</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 5.89</span>\n<span class=\"token keyword\">const</span> marqueeRank <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">2745</span> <span class=\"token operator\">/</span> <span class=\"token number\">2700</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 6.05</span>\n<span class=\"token keyword\">const</span> summertimeRank <span class=\"token operator\">=</span> <span class=\"token number\">2.5</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">3545</span> <span class=\"token operator\">/</span> <span class=\"token number\">2700</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 5.78</span></code></pre></div>\n<p>Now we’re getting somewhere. Even though <em>Cardinal</em> has the most playthroughs, <em>Marquee Moon</em> has the highest rank thanks to its lengthier runtime. <em>Summertime ‘06</em> is just barely in third place despite having a full playthrough less than <em>Cardinal</em>. The system works, folks.</p>\n<h2 id=\"this-is-the-part-with-the-but\"><a href=\"#this-is-the-part-with-the-but\" aria-label=\"this is the part with the but permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>This Is the Part With the “But”</h2>\n<p>Given all the information we need, the algorithm works. But we still have to get the information, and unfortunately, Last.fm doesn’t make it too easy on us:</p>\n<ul>\n<li>We can easily get a user’s top albums, but the response doesn’t include information on the amount of tracks on, or duration of, each album.</li>\n<li>Last.fm doesn’t use unique IDs to track albums, so we have to use an endpoint that searches by album name and artist to get detailed album information. This often fails or retrieves the wrong album, even when the album name and artist are provided by Last.fm (like from the previously discussed endpoint).</li>\n<li>Once we find an album, track listings are missing or incomplete about 20% of the time. This happens more often with newer albums.</li>\n<li>Neither the top albums nor album info endpoints give us the album’s release year. This doesn’t impact the algorithm, I just thought it was odd.</li>\n</ul>\n<p>All told, to implement this algorithm on our own means we would have to make an insane amount of requests just to get incomplete or missing data. If you think that doesn’t sound like it’s worth it, you’re right. And while I didn’t use it, <a href=\"https://gist.github.com/lowmess/f3c03b1a6fe50ee04622706047f8a654\">you can see an implementation here</a>.</p>\n<p>Last.fm still ranks albums wrong, though.</p>","id":"3912baf3-11a6-5470-a808-fa2586a51c8a","frontmatter":{"title":"哈哈哈123123","date":"March 12, 2018","datetime":"2018-03-12","description":"In its quest to glorify the scrobble, Last.fm has forgotten the humble album. We can almost fix that."},"fields":{"slug":"/frontend/4721c510-4a13-512a-a877-9e46c694d307"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/frontend/4721c510-4a13-512a-a877-9e46c694d307"}}}